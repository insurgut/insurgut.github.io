 <!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Last.fm Lyrics</title>
<meta property="og:type" content="website">
<meta property="og:url" content="">
<meta property="og:image" content="" sizes="300x300">
<meta property="og:title" content="">
<meta property="og:description" content="Сейчас играет на Last.fm">
<meta property="og:site_name" content="Last.fm Lyrics">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="">
<link rel="canonical" href="">
<style>
@import url('https://github.com/insurgut/insurgut/raw/refs/heads/main/YSMusic-HeadlineBold.woff2');
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'YSText-Bold',sans-serif;height:100vh;overflow:hidden;background:#000;color:#fff;transition:background .6s}
.container{display:flex;height:100vh;width:100%}
.cover-panel{width:35%;min-width:300px;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:20px}
.cover-image{width:280px;height:280px;border-radius:12px;object-fit:cover;box-shadow:0 0 20px rgba(0,0,0,.3);margin-bottom:20px}
.track-info{text-align:center;width:100%}
.track{font-size:1.6rem;margin-bottom:8px;opacity:.9}
.artist{font-size:1.3rem;opacity:.8}
.lyrics-panel{width:65%;padding:30px;overflow:hidden;position:relative}
#lyrics{font-size:3vw;font-weight:900;line-height:1.4;white-space:pre-line;width:100%;height:100vh;overflow-y:auto;overflow-x:hidden;scroll-behavior:smooth;padding-right:10px}
#lyrics::-webkit-scrollbar{width:4px}
#lyrics::-webkit-scrollbar-track{background:transparent}
#lyrics::-webkit-scrollbar-thumb{background:rgba(255,255,255,.3);border-radius:2px}
#username-input-screen{position:fixed;top:0;left:0;width:100%;height:100%;background:#000;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:9999;padding:20px;text-align:center}
#username-input-screen h1{font-size:2.8rem;margin-bottom:1rem}
#username-input-screen p{font-size:1.2rem;opacity:.8;margin-bottom:2rem;max-width:500px}
#username-input{width:100%;max-width:400px;padding:16px 20px;font-size:1.3rem;background:rgba(255,255,255,.1);border:2px solid rgba(255,255,255,.2);border-radius:12px;color:#fff;outline:none;transition:.3s}
#username-input:focus{border-color:#1db954;background:rgba(255,255,255,.15)}
#username-submit{margin-top:1.5rem;padding:14px 40px;font-size:1.3rem;font-weight:bold;background:#1db954;color:#fff;border:none;border-radius:12px;cursor:pointer;transition:.3s}
#username-submit:hover{background:#1ed760;transform:translateY(-2px)}
#spinner{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:48px;height:48px;border:4px solid rgba(255,255,255,.2);border-top:4px solid #1db954;border-radius:50%;animation:s 1s linear infinite;display:none}
@keyframes s{0%{transform:translate(-50%,-50%) rotate(0)}100%{transform:translate(-50%,-50%) rotate(360deg)}}
@media(max-width:768px){
.container{flex-direction:column}
.cover-panel{width:100%;height:45%;min-width:auto}
.lyrics-panel{width:100%;height:55%;padding:20px}
#lyrics{font-size:4.8vw;line-height:1.3}
.cover-image{width:220px;height:220px}
.track{font-size:1.4rem}
.artist{font-size:1.1rem}
#username-input-screen h1{font-size:2.2rem}
#username-input{font-size:1.1rem}
#username-submit{font-size:1.1rem;padding:12px 30px}
}
div{position:relative;top:-5px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}
</style>
</head>
<body>
<div id="username-input-screen">
<h1>Last.fm Lyrics</h1>
<p>Введите ваше имя пользователя Last.fm, чтобы увидеть текущий трек и текст песни в реальном времени.</p>
<input type="text" id="username-input" placeholder="Ваш username..." autocomplete="off">
<button id="username-submit">Показать</button>
</div>
<div class="container" id="main-content" style="display:none">
<div class="cover-panel">
<img id="coverImage" class="cover-image" src="" alt="Cover">
<div class="track-info">
<div id="track" class="track"></div>
<div id="artist" class="artist"></div>
</div>
</div>
<div class="lyrics-panel">
<div id="spinner"></div>
<div id="lyrics">Загрузка...</div>
</div>
</div>
<script>
const API_KEY='f11f903a1f16d7e30d4ff6eec84d50de',LRCLIB='https://lrclib.net/api',CORS='https://api.allorigins.win/get?url=',inputScreen=document.getElementById('username-input-screen'),main=document.getElementById('main-content'),userInput=document.getElementById('username-input'),submit=document.getElementById('username-submit'),spinner=document.getElementById('spinner'),ogUrl=document.querySelector('meta[property="og:url"]'),ogImg=document.querySelector('meta[property="og:image"]'),ogTitle=document.querySelector('meta[property="og:title"]'),twImg=document.querySelector('meta[name="twitter:image"]'),canon=document.querySelector('link[rel="canonical"]');
let lastId=null,curUser=location.hash.slice(1),siteUrl=location.origin+location.pathname;
function show(){inputScreen.style.display='none';main.style.display='flex';update();setInterval(update,10000)}
function load(){curUser=location.hash.slice(1).trim();if(curUser)show()}
submit.onclick=()=>{const v=userInput.value.trim();if(v)location.hash=v}
userInput.onkeypress=e=>{if(e.key==='Enter')submit.click()}
addEventListener('hashchange',load)
if(curUser){inputScreen.style.display='none';main.style.display='flex'}else userInput.focus()
async function proxy(u){try{const r=await fetch(CORS+encodeURIComponent(u)),d=await r.json();return d.contents}catch{return null}}
function dominant(img){return new Promise(r=>{const c=document.createElement('canvas'),x=c.getContext('2d');c.width=c.height=100;img.crossOrigin='anonymous';img.onload=()=>{x.drawImage(img,0,0,100,100);const d=x.getImageData(0,0,100,100).data,ct={};for(let i=0;i<d.length;i+=4)if(d[i+3]>128){const h='#'+((1<<24)+(d[i]<<16)+(d[i+1]<<8)+d[i+2]).toString(16).slice(1);ct[h]=(ct[h]||0)+1}let m=0,col='#000';for(let k in ct)if(ct[k]>m){m=ct[k];col=k}r(col)};img.onerror=()=>r('#1a1a1a')})}
function contrast(h){const r=parseInt(h.substr(1,2),16),g=parseInt(h.substr(3,2),16),b=parseInt(h.substr(5,2),16);return(r*299+g*587+b*114)/1000>128?'#000':'#fff'}
function format(t){if(!t)return'Тексты не найдены';t=t.trim().replace(/\r/g,'');let l=t.split('\n').map(x=>x.trim()).filter(x=>x);if(l.length===1){const w=t.split(/\s+/).filter(x=>x);l=[];let i=0;while(i<w.length){let line=w[i],j=i+1;while(j<w.length&&(line+' '+w[j]).length<=40&&j<i+8){line+=' '+w[j];j++}l.push(line);i=j}}return l.map(x=>x.charAt(0).toUpperCase()+x.slice(1)).join('\n')}
async function track(u){const res=await fetch(`https://ws.audioscrobbler.com/2.0/?method=user.getrecenttracks&user=${u}&api_key=${API_KEY}&format=json&limit=1`),d=await res.json();if(!d.recenttracks?.track?.[0])throw'Нет трека';const t=d.recenttracks.track[0];return{id:t.url,artist:t.artist['#text']||t.artist,track:t.name,album:t.album?.['#text']||'',duration:t.duration?Math.floor(t.duration/1000):180,image:t.image?.find(i=>i.size==='extralarge')?.['#text']||t.image?.find(i=>i.size==='large')?.['#text']||'https://lastfm.freetls.fastly.net/i/u/300x300/2a96cbd8b46e442fc41c2b86b821562f.png'}}
async function itunesCover(a,t){try{const r=await fetch(`https://itunes.apple.com/search?term=${encodeURIComponent(a+' '+t)}&entity=song&limit=1`),j=await r.json();return j.results[0]?.artworkUrl100?.replace('100x100','300x300')||null}catch{return null}}
async function lyrics(info){try{const r=await fetch(`${LRCLIB}/get?artist_name=${encodeURIComponent(info.artist)}&track_name=${encodeURIComponent(info.track)}&album_name=${encodeURIComponent(info.album)}&duration=${info.duration}`);if(r.ok){const d=await r.json();if(d.plainLyrics||d.syncedLyrics||d.instrumental)return d}}catch{}try{const r=await fetch(`${LRCLIB}/search?q=${encodeURIComponent(info.track+' '+info.artist)}`);if(r.ok){const s=await r.json();if(s[0]){const d=await fetch(`${LRCLIB}/get/${s[0].id}`);if(d.ok){const j=await d.json();if(j.plainLyrics||j.instrumental)return j}}}}catch{}try{const h=await proxy(`https://api.genius.com/search?q=${encodeURIComponent(info.track+' '+info.artist)}`);if(h){const m=h.match(/"url":"([^"]+)"/);if(m){const p=await proxy(m[1].replace(/\\/g,''));if(p){const l=p.match(/<div class="lyrics">([\s\S]*?)<\/div>/i);if(l){const txt=l[1].replace(/<[^>]+>/g,'').trim();if(txt)return{plainLyrics:txt}}}}}}catch{}try{const r=await fetch(`https://api.lyrics.ovh/v1/${encodeURIComponent(info.artist)}/${encodeURIComponent(info.track)}`);if(r.ok){const d=await r.json();if(d.lyrics?.trim())return{plainLyrics:d.lyrics}}}catch{}try{const s=await proxy(`https://search.azlyrics.com/search.php?q=${encodeURIComponent(info.artist+' '+info.track)}`);if(s){const l=s.match(/href="(\/lyrics\/[^"]+)"/);if(l){const p=await proxy('https://www.azlyrics.com'+l[1]);if(p){const m=p.match(/<!-- Usage of azlyrics.com content -->[\s\S]*?<div[^>]*>([\s\S]*?)<\/div>/i);if(m){const txt=m[1].replace(/<br\s*\/?>/gi,'\n').replace(/<[^>]+>/g,'').trim();if(txt)return{plainLyrics:txt}}}}}}catch{}return{plainLyrics:'Тексты не найдены'}}
async function update(){if(!curUser)return;try{spinner.style.display='block';const info=await track(curUser);if(lastId===info.id){spinner.style.display='none';return}lastId=info.id;let imgSrc=info.image;const it=await itunesCover(info.artist,info.track);if(it)imgSrc=it;const img=new Image();img.src=imgSrc;const bg=await dominant(img),txt=contrast(bg);document.body.style.backgroundColor=bg;document.querySelectorAll('.cover-panel,.track-info,#lyrics').forEach(e=>e.style.color=txt);document.getElementById('coverImage').src=imgSrc;document.getElementById('track').textContent=info.track;document.getElementById('artist').textContent=info.artist;const l=await lyrics(info);const txtL=l.instrumental?'Инструментал':l.plainLyrics?format(l.plainLyrics):'Тексты не найдены';document.getElementById('lyrics').textContent=txtL;document.getElementById('lyrics').scrollTop=0;const ts=Date.now();ogImg.content=imgSrc+'?t='+ts;ogTitle.content=info.track+' — '+info.artist;twImg.content=imgSrc+'?t='+ts;ogUrl.content=siteUrl+'#'+curUser;canon.href=siteUrl+'#'+curUser;}catch(e){document.getElementById('lyrics').textContent='Ошибка: '+e.message}finally{spinner.style.display='none'}}
if(curUser)load()
</script>
</body>
</html>
